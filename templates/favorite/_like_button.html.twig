{# Fichier: templates/favorite/_like_button.html.twig #}

{# Le bouton est affich√© uniquement si un utilisateur est connect√© #}
{% if app.user %}
    {# Calculez le statut si non fourni (pour le rendu initial de la page) #}
    {% if isLiked is not defined %}
        {% set isLiked = is_article_liked(article.url) %}
    {% endif %}

    {# Cr√©e un ID de jeton CSRF unique et un nom de frame bas√© sur le hash de l'URL #}
    {% set urlHash = article.url|hash %}
    {% set token_id = 'favorite_toggle' ~ urlHash %}

    {# NOUVELLE STRUCTURE : La DIV sert de Turbo Frame et de conteneur pour le positionnement absolu #}
    <div data-turbo-frame="like_button_frame_{{ urlHash }}" class="like-button-container">
        <form method="POST" action="{{ path('app_favorite_toggle') }}">
            {# Jeton CSRF pour la s√©curit√© #}
            <input type="hidden" name="_token" value="{{ csrf_token(token_id) }}">

            {# Champs cach√©s pour renvoyer les donn√©es de l'article au contr√¥leur #}
            <input type="hidden" name="url" value="{{ article.url }}">
            <input type="hidden" name="title" value="{{ article.title }}">
            <input type="hidden" name="image" value="{{ article.image }}">
            <input type="hidden" name="sourceName" value="{{ article.source.name|default('Source Inconnue') }}">

            {# Utilisation des classes Bootstrap pour enlever le style de bouton par d√©faut #}
            <button type="submit" class="btn btn-link p-0 like-button-icon" title="Ajouter aux favoris">

                {# L'ic√¥ne change en fonction de l'√©tat de "like" #}
                {% if isLiked %}
                    <span style="color: red;">‚ù§Ô∏è</span>
                {% else %}
                    <span>ü§ç</span>
                {% endif %}
            </button>
        </form>
    </div>
{% endif %}
